产品需求文档 (PRD)：AC-Insight 智能经营分析工作台
版本： V1.0
负责人： yangna
状态： 方案评审中 / 准备进入 MVP 开发

## 1. 项目背景与痛点分析

### 1.1 业务背景
在 CRM 和进销存系统中，传统的报表功能通常由研发预设。随着业务复杂度增加，管理者对数据的需求变得多维且即时（如：想看特定区域、特定利润口径下的客户贡献）。

### 1.2 核心痛点
- **口径不一**：财务、销售、运营对"毛利"、"活跃客户"等指标定义不同，导致数据结论冲突。
- **查询门槛高**：业务人员不具备 SQL 能力，研发响应周期长，数据导出 Excel 后的人工加工链路低效且易错。
- **安全风险**：大语言模型（LLM）直接查询数据库时，难以通过传统 RBAC（基于角色的访问控制）权限体系精准控制到"行"和"敏感字段"。

## 2. 产品目标
- **语义标准化**：通过"语义中台"统一全公司的指标计算逻辑。
- **零代码交互**：实现自然语言驱动的报表生成与洞察，降低数据获取门槛。
- **内生安全**：构建一套 AI 原生的权限拦截体系，确保销售无法越权查看成本与他人数据。

## 3. 用户角色与权限定义

| 角色 | 核心权限 | 关注点 |
|------|----------|--------|
| 系统管理员 (Admin) | 配置语义字典、定义指标公式、管理全量数据权限。 | 数据的准确性、口径的统一性、系统安全性。 |
| 销售经理 (Manager) | 查看团队内客户的销售、毛利及往来款数据。 | 团队业绩达成、高价值客户挖掘。 |
| 普通销售 (Sales) | 仅查看自己名下客户的销量及欠款明细。 | 个人指标达成、回款催收、客户维系。 |

## 4. 核心功能需求

### 4.1 语义中台 (Semantic Center)
- **指标管理**：支持可视化配置业务逻辑。
  - 示例：配置 毛利 = (单价 - 成本) * 数量。
- **同义词库**：支持为字段配置业务别名。
  - 示例：unpaid_amount 对应 欠款、待回款、没给钱的。
- **字段密级标记**：标记字段的安全等级（L0-公开，L1-高密级/仅管理员可见）。

### 4.2 权限拦截引擎 (Security Engine)
- **敏感字段脱敏**：AI 在接收到非 Admin 指令时，自动屏蔽 L1 等级指标的逻辑解析。
- **行级权限硬注入 (Row-Level Security)**：当非 Admin 身份发起查询，系统强制在 AI 生成的查询逻辑中注入过滤条件：WHERE owner_id = {current_user_id}。

### 4.3 智能查询看板 (AI Portal)
- **对话式查询**：支持模糊意图识别与复杂的多表关联查询。
- **逻辑自证明 (Explainable AI)**：界面需展示"推理过程"，如："已识别您的角色为'销售'，已为您屏蔽'成本'相关指标，并限定查看您个人名下的客户数据"。
- **动态数据可视化**：若结果为"排名类"，自动渲染为柱状图。若结果为"趋势类"，自动渲染为折线图。

## 5. 核心交互流程 (User Flow)

1. **管理员配置**：在后台定义 毛利 指标公式，并将其设为 L1 高密级字段。
2. **身份模拟**：在 Demo 演示界面切换角色为"普通销售"。
3. **用户提问**：销售提问："我上个月毛利最高的客户是谁？"
4. **实时拦截**：系统检测角色权限，识别到销售无权访问 L1 字段，自动拦截"毛利"计算，建议用户查询"销售额"。
5. **结果输出**：AI 基于行级过滤逻辑，输出该销售名下客户的销售额排名。

## 6. MVP 验收标准 (Acceptance Criteria)
- **计算一致性**：AI 生成的查询逻辑必须严格遵循语义层定义的公式。
- **权限韧性**：在普通销售身份下，通过任何引导性提问（Prompt Injection）均无法非法获取"成本价"或"他人客户数据"。
- **响应效率**：从提问到图表渲染完成，端到端延迟需控制在 5s 以内。

## 7. 后续规划 (Roadmap)
- **V1.1**：增加异常数据主动预警（如：客户欠款环比增加 30% 时自动推送）。
- **V1.2**：接入 GLM-4.5-Air 等高性能国产模型进行长文本业务指令优化。